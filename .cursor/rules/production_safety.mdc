---
description: Reglas de seguridad para aplicaciones en producciÃ³n con usuarios reales
globs: **/*
alwaysApply: true
---

# ğŸš¨ **REGLAS DE SEGURIDAD PARA PRODUCCIÃ“N**

## **âš ï¸ ESTADO CRÃTICO: APLICACIÃ“N EN PRODUCCIÃ“N**

- **Esta aplicaciÃ³n estÃ¡ en PRODUCCIÃ“N con usuarios reales**
- **La base de datos contiene informaciÃ³n real de usuarios**
- **NUNCA eliminar, modificar o corromper datos existentes**
- **Siempre verificar impacto antes de cualquier cambio**

---

## **ğŸ”’ PROTECCIÃ“N DE DATOS**

### **Base de Datos - NUNCA HACER:**

- âŒ **NUNCA usar `DROP TABLE`** sin confirmaciÃ³n explÃ­cita del usuario
- âŒ **NUNCA usar `DELETE FROM`** en tablas con datos de usuarios
- âŒ **NUNCA usar `TRUNCATE`** en tablas de producciÃ³n
- âŒ **NUNCA modificar esquemas** sin backup previo
- âŒ **NUNCA ejecutar scripts SQL** sin revisar impacto

### **Base de Datos - SIEMPRE HACER:**

- âœ… **Usar `CREATE TABLE IF NOT EXISTS`** para nuevas tablas
- âœ… **Usar `ALTER TABLE ADD COLUMN`** para agregar columnas
- âœ… **Usar `DROP POLICY IF EXISTS`** antes de crear polÃ­ticas RLS
- âœ… **Verificar que no se eliminen datos** antes de ejecutar
- âœ… **Crear backups** antes de cambios importantes

---

## **ğŸ›¡ï¸ VALIDACIÃ“N DE CAMBIOS**

### **Antes de cualquier cambio en base de datos:**

1. **Verificar que NO se eliminen datos existentes**
2. **Confirmar que solo se agreguen nuevas funcionalidades**
3. **Revisar que las polÃ­ticas RLS no bloqueen acceso existente**
4. **Asegurar que los usuarios actuales mantengan sus datos**

### **Scripts SQL seguros:**

```sql
-- âœ… SEGURO: Crear nuevas tablas
CREATE TABLE IF NOT EXISTS new_table (...);

-- âœ… SEGURO: Agregar columnas
ALTER TABLE existing_table ADD COLUMN new_column type;

-- âœ… SEGURO: Crear polÃ­ticas RLS
DROP POLICY IF EXISTS "policy_name" ON table_name;
CREATE POLICY "policy_name" ON table_name ...;

-- âŒ PELIGROSO: Eliminar datos
DROP TABLE existing_table;
DELETE FROM existing_table;
TRUNCATE existing_table;
```

---

## **ğŸ” VERIFICACIÃ“N DE IMPACTO**

### **Preguntas obligatorias antes de cambios:**

1. **Â¿Se eliminarÃ¡n datos existentes?** â†’ Si es SÃ, NO proceder
2. **Â¿Se modificarÃ¡n datos existentes?** â†’ Si es SÃ, confirmar con usuario
3. **Â¿Se afectarÃ¡ el acceso de usuarios actuales?** â†’ Si es SÃ, revisar polÃ­ticas
4. **Â¿Se crearÃ¡ nueva funcionalidad sin afectar existente?** â†’ Si es SÃ, proceder

### **Patrones seguros:**

- **Agregar funcionalidad** sin modificar existente
- **Crear nuevas tablas** para nuevas caracterÃ­sticas
- **Mantener compatibilidad** con datos existentes
- **Preservar acceso** de usuarios actuales

---

## **ğŸ“‹ CHECKLIST DE SEGURIDAD**

### **Antes de ejecutar cualquier script:**

- [ ] **Verificado que NO se eliminen datos**
- [ ] **Confirmado que solo se agreguen funcionalidades**
- [ ] **Revisado que usuarios actuales mantengan acceso**
- [ ] **Validado que no se corrompan datos existentes**
- [ ] **Asegurado que la aplicaciÃ³n siga funcionando**

### **DespuÃ©s de ejecutar scripts:**

- [ ] **Verificado que la aplicaciÃ³n funcione correctamente**
- [ ] **Confirmado que usuarios pueden acceder a sus datos**
- [ ] **Validado que nuevas funcionalidades trabajen**
- [ ] **Revisado que no haya errores en consola**

---

## **ğŸš¨ ALERTAS CRÃTICAS**

### **Si detectas cualquiera de estos patrones, DETENER inmediatamente:**

- `DROP TABLE` sin confirmaciÃ³n explÃ­cita
- `DELETE FROM` en tablas de usuarios
- `TRUNCATE` en cualquier tabla
- Modificaciones a esquemas existentes sin backup
- Cambios que puedan afectar datos de usuarios reales

### **Comandos de emergencia:**

- **Detener ejecuciÃ³n** si hay riesgo de pÃ©rdida de datos
- **Informar al usuario** sobre cualquier riesgo potencial
- **Sugerir backup** antes de cambios importantes
- **Validar impacto** antes de proceder

---

## **ğŸ’¡ MEJORES PRÃCTICAS**

### **Para nuevas funcionalidades:**

1. **Crear nuevas tablas** en lugar de modificar existentes
2. **Agregar columnas opcionales** con valores por defecto
3. **Mantener retrocompatibilidad** con datos existentes
4. **Probar en entorno de desarrollo** antes de producciÃ³n

### **Para polÃ­ticas RLS:**

1. **Usar `DROP POLICY IF EXISTS`** antes de crear nuevas
2. **Verificar que no bloqueen acceso existente**
3. **Mantener polÃ­ticas existentes** que funcionan
4. **Agregar nuevas polÃ­ticas** sin modificar las actuales

---

**ğŸ¯ OBJETIVO PRINCIPAL: Preservar la integridad de los datos de usuarios reales mientras se agregan nuevas funcionalidades de manera segura.**
